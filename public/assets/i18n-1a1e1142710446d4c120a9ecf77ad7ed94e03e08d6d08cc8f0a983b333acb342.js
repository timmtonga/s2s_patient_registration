var I18n=I18n||{};I18n.defaultLocale="en",I18n.fallbacks=!1,I18n.defaultSeparator=".",I18n.locale=null,I18n.PLACEHOLDER=/(?:\{\{|%\{)(.*?)(?:\}\}?)/gm,I18n.isValidNode=function(e,t,r){return null!==e[t]&&e[t]!==r},I18n.lookup=function(e,t){var r,t=t||{},n=e,a=this.prepareOptions(I18n.translations),i=a[t.locale||I18n.currentLocale()],t=this.prepareOptions(t);if(i){for("object"==typeof e&&(e=e.join(this.defaultSeparator)),t.scope&&(e=t.scope.toString()+this.defaultSeparator+e),e=e.split(this.defaultSeparator);e.length>0;)if(r=e.shift(),i=i[r],!i){I18n.fallbacks&&!t.fallback&&(i=I18n.lookup(n,this.prepareOptions({locale:I18n.defaultLocale,fallback:!0},t)));break}return!i&&this.isValidNode(t,"defaultValue")&&(i=t.defaultValue),i}},I18n.prepareOptions=function(){for(var e,t={},r=arguments.length,n=0;r>n;n++)if(e=arguments[n])for(var a in e)this.isValidNode(t,a)||(t[a]=e[a]);return t},I18n.interpolate=function(e,t){t=this.prepareOptions(t);var r,n,a,i=e.match(this.PLACEHOLDER);if(!i)return e;for(var o=0;r=i[o];o++)a=r.replace(this.PLACEHOLDER,"$1"),n=t[a],this.isValidNode(t,a)||(n="[missing "+r+" value]"),regex=new RegExp(r.replace(/\{/gm,"\\{").replace(/\}/gm,"\\}")),e=e.replace(regex,n);return e},I18n.translate=function(e,t){t=this.prepareOptions(t);var r=this.lookup(e,t);try{return"object"==typeof r?"number"==typeof t.count?this.pluralize(t.count,e,t):r:this.interpolate(r,t)}catch(n){return this.missingTranslation(e)}},I18n.localize=function(e,t){switch(e){case"currency":return this.toCurrency(t);case"number":return e=this.lookup("number.format"),this.toNumber(t,e);case"percentage":return this.toPercentage(t);default:return e.match(/^(date|time)/)?this.toTime(e,t):t.toString()}},I18n.parseDate=function(e){var t,r;if("object"==typeof e)return e;if(t=e.toString().match(/(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2}):(\d{2}))?(Z|\+0000)?/)){for(var n=1;6>=n;n++)t[n]=parseInt(t[n],10)||0;t[2]-=1,r=t[7]?new Date(Date.UTC(t[1],t[2],t[3],t[4],t[5],t[6])):new Date(t[1],t[2],t[3],t[4],t[5],t[6])}else"number"==typeof e?(r=new Date,r.setTime(e)):e.match(/\d+ \d+:\d+:\d+ [+-]\d+ \d+/)?(r=new Date,r.setTime(Date.parse(e))):(r=new Date,r.setTime(Date.parse(e)));return r},I18n.toTime=function(e,t){var r=this.parseDate(t),n=this.lookup(e);return r.toString().match(/invalid/i)?r.toString():n?this.strftime(r,n):r.toString()},I18n.strftime=function(e,t){var r=this.lookup("date");if(!r)return e.toString();r.meridian=r.meridian||["AM","PM"];var n=e.getDay(),a=e.getDate(),i=e.getFullYear(),o=e.getMonth()+1,s=e.getHours(),l=s,p=s>11?1:0,u=e.getSeconds(),c=e.getMinutes(),h=e.getTimezoneOffset(),m=Math.floor(Math.abs(h/60)),f=Math.abs(h)-60*m,d=(h>0?"-":"+")+(m.toString().length<2?"0"+m:m)+(f.toString().length<2?"0"+f:f);l>12?l-=12:0===l&&(l=12);var g=function(e){var t="0"+e.toString();return t.substr(t.length-2)},b=t;return b=b.replace("%a",r.abbr_day_names[n]),b=b.replace("%A",r.day_names[n]),b=b.replace("%b",r.abbr_month_names[o]),b=b.replace("%B",r.month_names[o]),b=b.replace("%d",g(a)),b=b.replace("%e",a),b=b.replace("%-d",a),b=b.replace("%H",g(s)),b=b.replace("%-H",s),b=b.replace("%I",g(l)),b=b.replace("%-I",l),b=b.replace("%m",g(o)),b=b.replace("%-m",o),b=b.replace("%M",g(c)),b=b.replace("%-M",c),b=b.replace("%p",r.meridian[p]),b=b.replace("%S",g(u)),b=b.replace("%-S",u),b=b.replace("%w",n),b=b.replace("%y",g(i)),b=b.replace("%-y",g(i).replace(/^0+/,"")),b=b.replace("%Y",i),b=b.replace("%z",d)},I18n.toNumber=function(e,t){t=this.prepareOptions(t,this.lookup("number.format"),{precision:3,separator:".",delimiter:",",strip_insignificant_zeros:!1});var r,n,a=0>e,i=Math.abs(e).toFixed(t.precision).toString(),o=i.split("."),s=[];for(e=o[0],r=o[1];e.length>0;)s.unshift(e.substr(Math.max(0,e.length-3),3)),e=e.substr(0,e.length-3);if(n=s.join(t.delimiter),t.precision>0&&(n+=t.separator+o[1]),a&&(n="-"+n),t.strip_insignificant_zeros){var l={separator:new RegExp(t.separator.replace(/\./,"\\.")+"$"),zeros:/0+$/};n=n.replace(l.zeros,"").replace(l.separator,"")}return n},I18n.toCurrency=function(e,t){return t=this.prepareOptions(t,this.lookup("number.currency.format"),this.lookup("number.format"),{unit:"$",precision:2,format:"%u%n",delimiter:",",separator:"."}),e=this.toNumber(e,t),e=t.format.replace("%u",t.unit).replace("%n",e)},I18n.toHumanSize=function(e,t){for(var r,n,a=1024,i=e,o=0;i>=a&&4>o;)i/=a,o+=1;return 0===o?(r=this.t("number.human.storage_units.units.byte",{count:i}),n=0):(r=this.t("number.human.storage_units.units."+[null,"kb","mb","gb","tb"][o]),n=i-Math.floor(i)===0?0:1),t=this.prepareOptions(t,{precision:n,format:"%n%u",delimiter:""}),e=this.toNumber(i,t),e=t.format.replace("%u",r).replace("%n",e)},I18n.toPercentage=function(e,t){return t=this.prepareOptions(t,this.lookup("number.percentage.format"),this.lookup("number.format"),{precision:3,separator:".",delimiter:""}),e=this.toNumber(e,t),e+"%"},I18n.pluralize=function(e,t,r){var n;try{n=this.lookup(t,r)}catch(a){}if(!n)return this.missingTranslation(t);var i;switch(r=this.prepareOptions(r),r.count=e.toString(),Math.abs(e)){case 0:i=this.isValidNode(n,"zero")?n.zero:this.isValidNode(n,"none")?n.none:this.isValidNode(n,"other")?n.other:this.missingTranslation(t,"zero");break;case 1:i=this.isValidNode(n,"one")?n.one:this.missingTranslation(t,"one");break;default:i=this.isValidNode(n,"other")?n.other:this.missingTranslation(t,"other")}return this.interpolate(i,r)},I18n.missingTranslation=function(){for(var e='[missing "'+this.currentLocale(),t=arguments.length,r=0;t>r;r++)e+="."+arguments[r];return e+='" translation]'},I18n.currentLocale=function(){return I18n.locale||I18n.defaultLocale},I18n.t=I18n.translate,I18n.l=I18n.localize,I18n.p=I18n.pluralize;